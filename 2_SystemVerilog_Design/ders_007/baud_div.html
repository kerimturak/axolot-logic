<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UART Baud Rate Bölücü Animasyonu</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f2f5;
            color: #333;
            padding: 20px;
        }
        h1 {
            color: #1a73e8;
            margin-bottom: 20px;
        }
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 95%;
            max-width: 1200px;
        }
        canvas {
            border: 2px solid #ccc;
            background-color: #fdfdfd;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        .controls label {
            font-size: 16px;
            font-weight: 600;
        }
        .controls select, .controls input {
            padding: 8px;
            font-size: 14px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .controls input {
            width: 40px;
            text-align: center;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            color: white;
            background-color: #1a73e8;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #0b5fb6;
        }
        button:disabled {
            background-color: #9e9e9e;
            cursor: not-allowed;
        }
        .status-text {
            font-size: 18px;
            font-weight: bold;
            color: #d9534f;
            margin-top: 10px;
            height: 30px;
            text-align: center;
        }
        .info-panel {
            display: none;
            width: 90%;
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            line-height: 1.6;
        }
        .info-panel h3 {
            color: #1a73e8;
            margin-top: 0;
        }
        .info-panel p {
            margin: 10px 0;
        }
        .legend-box {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border: 1px solid #ccc;
        }
        .signal-label {
            position: absolute;
            font-weight: bold;
            font-size: 16px;
            color: #333;
            left: 20px;
            transform: translateY(-50%);
        }
        #clk-label { top: 100px; }
        #baud-label { top: 200px; }
        #uart-label { top: 300px; }
    </style>
</head>
<body>
    <h1>UART Baud Rate Bölücü Animasyonu</h1>
    <div class="main-container" style="position: relative;">
        <span class="signal-label" id="clk-label">Sistem Saati (CLK)</span>
        <span class="signal-label" id="baud-label">UART Baud Saati</span>
        <span class="signal-label" id="uart-label">UART Tx Sinyali</span>
        
        <canvas id="baudDividerCanvas" width="1100" height="400"></canvas>
        <div class="controls">
            <label for="char-input">Gönderilecek Karakter:</label>
            <input type="text" id="char-input" value="A" maxlength="1">
            <label for="divider-select">Bölücü Değeri (N):</label>
            <select id="divider-select">
                <option value="4">4</option>
                <option value="8">8</option>
                <option value="16" selected>16</option>
                <option value="32">32</option>
            </select>
            <label for="speed-select">Animasyon Hızı:</label>
            <select id="speed-select">
                <option value="100">Normal</option>
                <option value="200">Yavaş</option>
                <option value="400">Çok Yavaş</option>
            </select>
            <button id="startButton" onclick="startAnimation()">Başlat</button>
            <button id="infoButton" onclick="toggleInfo()">Bölücü Hakkında Bilgi</button>
        </div>
        <div id="status-text" class="status-text">Durum: Animasyon başlamaya hazır.</div>
        <div id="info-panel" class="info-panel"></div>
    </div>
    
    <script>
        const canvas = document.getElementById('baudDividerCanvas');
        const ctx = canvas.getContext('2d');
        const dividerSelect = document.getElementById('divider-select');
        const charInput = document.getElementById('char-input');
        const speedSelect = document.getElementById('speed-select');
        const startButton = document.getElementById('startButton');
        const infoPanel = document.getElementById('info-panel');
        const statusText = document.getElementById('status-text');

        const CANVAS_WIDTH = 1100;
        const CANVAS_HEIGHT = 400;
        const CLK_Y = 100;
        const BAUD_Y = 200;
        const UART_Y = 300;
        const H_GAP = 12; // Her bir sistem saati döngüsü için yatay boşluk

        const DATA_BITS = 8;
        
        let dividerValue = 16;
        let animationSpeed = 100; // Animasyon hızı
        let currentAnimationStep = 0;
        let isAnimating = false;
        
        let dataBits = [];
        const totalBits = DATA_BITS + 2; // Start + 8 Data + Stop
        const totalAnimationSteps = totalBits * 16; // 16, bir bit süresi (örnek olarak)

        function initializeData() {
            const char = charInput.value.trim().toUpperCase();
            const charCode = char.length === 1 ? char.charCodeAt(0) : 'A'.charCodeAt(0);
            
            dataBits = [];
            dataBits.push(0); // Start bit
            for (let i = 0; i < DATA_BITS; i++) {
                dataBits.push((charCode >> i) & 1);
            }
            dataBits.push(1); // Stop bit
        }

        function drawSignals(highlightedBitIndex = -1, subBitIndex = -1) {
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
            
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, CLK_Y); ctx.lineTo(CANVAS_WIDTH, CLK_Y);
            ctx.moveTo(0, BAUD_Y); ctx.lineTo(CANVAS_WIDTH, BAUD_Y);
            ctx.moveTo(0, UART_Y); ctx.lineTo(CANVAS_WIDTH, UART_Y);
            ctx.stroke();

            // Sinyal Hatlarını Çiz
            // Sistem Saati (CLK)
            ctx.strokeStyle = '#ff8f00';
            ctx.lineWidth = 2;
            for (let i = 0; i < CANVAS_WIDTH / H_GAP; i++) {
                const x = i * H_GAP;
                const nextX = x + H_GAP;
                const y = (i % 2 === 0) ? CLK_Y : CLK_Y - 30;
                const nextY = (i % 2 === 0) ? CLK_Y - 30 : CLK_Y;
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(nextX, y);
                ctx.lineTo(nextX, nextY);
                ctx.stroke();
            }

            // Baud Saati ve UART Sinyali
            let currentBaudState = 0;
            let currentBaudCount = 0;
            let currentUartBitIndex = -1;
            
            for (let i = 0; i < CANVAS_WIDTH / H_GAP; i++) {
                const x = i * H_GAP;
                const nextX = x + H_GAP;
                
                // Baud Saati
                if (currentBaudCount < dividerValue - 1) {
                    currentBaudState = 0;
                    currentBaudCount++;
                } else {
                    currentBaudState = 1;
                    currentBaudCount = 0;
                }
                const baudYPos = currentBaudState === 1 ? BAUD_Y - 30 : BAUD_Y;
                ctx.strokeStyle = '#007bff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(x, baudYPos);
                ctx.lineTo(nextX, baudYPos);
                ctx.stroke();

                // UART Sinyali
                if (currentBaudState === 1) {
                    currentUartBitIndex++;
                }
                
                let uartBit = 1; // Başlangıçta boşta (Idle)
                if (currentUartBitIndex >= 0 && currentUartBitIndex < dataBits.length) {
                    uartBit = dataBits[currentUartBitIndex];
                }
                
                const uartYPos = uartBit === 1 ? UART_Y - 30 : UART_Y;
                ctx.strokeStyle = '#4CAF50';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(x, uartYPos);
                ctx.lineTo(nextX, uartYPos);
                ctx.stroke();

                // Bit başlıklarını çiz
                if (currentBaudCount === 0 && currentUartBitIndex >= 0 && currentUartBitIndex <= totalBits) {
                    let bitLabel = '';
                    if (currentUartBitIndex === 0) bitLabel = 'Start';
                    else if (currentUartBitIndex > 0 && currentUartBitIndex <= DATA_BITS) bitLabel = `D${currentUartBitIndex - 1}`;
                    else if (currentUartBitIndex === DATA_BITS + 1) bitLabel = 'Stop';
                    
                    ctx.fillStyle = '#333';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(bitLabel, x + (dividerValue * H_GAP) / 2, UART_Y + 25);
                }
            }
            
            // Animasyon imlecini çiz
            if (highlightedBitIndex !== -1) {
                const bitX = highlightedBitIndex * dividerValue * H_GAP;
                const cursorX = bitX + (subBitIndex * H_GAP);
                
                ctx.strokeStyle = '#d9534f';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(cursorX, 0);
                ctx.lineTo(cursorX, CANVAS_HEIGHT);
                ctx.stroke();
            }
        }

        function animate() {
            if (!isAnimating) {
                return;
            }
            
            const bitIndex = Math.floor(currentAnimationStep / dividerValue);
            const subBitIndex = currentAnimationStep % dividerValue;

            drawSignals(bitIndex, subBitIndex);

            let currentStatus = '';
            if (bitIndex < totalBits) {
                const bitValue = dataBits[bitIndex];
                let bitType = '';
                if (bitIndex === 0) bitType = 'Başlangıç Biti (0)';
                else if (bitIndex > 0 && bitIndex <= DATA_BITS) bitType = `Veri Biti ${bitIndex - 1} (${bitValue})`;
                else if (bitIndex === DATA_BITS + 1) bitType = 'Durdurma Biti (1)';
                
                currentStatus = `Durum: ${bitType} gönderiliyor.`;
                statusText.textContent = currentStatus;
            } else {
                currentStatus = `Durum: İletim tamamlandı. "${charInput.value.toUpperCase()}" karakteri gönderildi.`;
                statusText.textContent = currentStatus;
                isAnimating = false;
                startButton.disabled = false;
                drawSignals(totalBits - 1, dividerValue - 1);
                return;
            }
            
            currentAnimationStep++;
            setTimeout(animate, animationSpeed);
        }

        function startAnimation() {
            if (isAnimating) return;
            isAnimating = true;
            startButton.disabled = true;
            dividerValue = parseInt(dividerSelect.value);
            animationSpeed = parseInt(speedSelect.value);
            currentAnimationStep = 0;
            initializeData();
            animate();
        }

        function toggleInfo() {
            if (infoPanel.style.display === 'block') {
                infoPanel.style.display = 'none';
            } else {
                infoPanel.innerHTML = `
                    <h3>Baud Rate Bölücü (Baud Divider) Nedir?</h3>
                    <p>UART, veriyi bit bit gönderen bir iletişim protokolüdür. Bu bitlerin ne kadar sürede gönderileceğini belirleyen hıza **baud rate** denir.</p>
                    <p>Fakat mikrodenetleyiciler çok hızlı bir **sistem saatine (System Clock)** sahiptir. UART, bu hızlı saatle doğrudan çalışmak yerine, daha yavaş bir **baud saati** üretir. Bu yavaş saat, her bir veri bitini göndermek için bir referans görevi görür.</p>
                    <p><b>Nasıl Çalışır?</b></p>
                    <p>Baud rate bölücü, sistem saatini sizin belirlediğiniz bir **N** değerine bölerek baud saatini oluşturur. </p>
                    <ul>
                        <li>Animasyonda, **Sistem Saati** en hızlı çalışan saat sinyalidir.</li>
                        <li>**UART Baud Saati**, N değerine göre daha yavaş bir frekansa sahiptir. Örneğin, **N=16** seçildiğinde, bir baud saati vuruşu oluşması için 16 sistem saati vuruşu beklenir.</li>
                        <li>**UART Tx Sinyali** ise, her bir baud saati vuruşunda bir sonraki bitin sinyal seviyesini günceller.</li>
                    </ul>
                    <p>Kısacası, **N değeri büyüdükçe**, baud saati yavaşlar ve veri iletim hızı düşer.</p>
                `;
                infoPanel.style.display = 'block';
            }
        }

        drawSignals();
    </script>
</body>
</html>